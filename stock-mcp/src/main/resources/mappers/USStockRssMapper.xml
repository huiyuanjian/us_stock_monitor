<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.stock.mapper.USStockRssMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.stock.entity.USStockRss">
        <id column="id" property="id" />
        <result column="stock_code" property="stockCode" />
        <result column="title" property="title" />
        <result column="title_zh" property="titleZh" />
        <result column="link" property="link" />
        <result column="pub_date_gmt" property="pubDateGmt" />
        <result column="pub_date_bj" property="pubDateBj" />
        <result column="tags" property="tags" />
    </resultMap>

    <select id="queryStockCountsBetweenDate" parameterType="map" resultType="com.stock.entity.StockCounts">

        SELECT
            stock_code AS stockCode,
            COUNT(*) AS occurCounts
        FROM
            us_stock_rss
        WHERE
            pub_date_bj &lt;= #{paramMap.endDate} AND pub_date_bj &gt;= #{paramMap.startDate}
        GROUP BY
            stock_code
        HAVING
            occurCounts &gt;= #{paramMap.targetCounts}
        ORDER BY
            occurCounts
        DESC

    </select>

    <select id="queryStockByTitleKeywords" resultType="com.stock.entity.USStockRss">

        SELECT
            *
        FROM
            us_stock_rss
        WHERE
        (
            <!-- title 动态关键词搜索 -->
            <foreach collection="keywords" item="kw" separator=" OR ">
                title LIKE CONCAT('%', #{kw}, '%')
            </foreach>

            OR

            <!-- title_zh 动态关键词搜索 -->
            <foreach collection="keywords" item="kw" separator=" OR ">
                title_zh LIKE CONCAT('%', #{kw}, '%')
            </foreach>
        )
        ORDER BY
            pub_date_bj
        DESC

    </select>

</mapper>